global
    daemon
    log /dev/log local0
    user haproxy
    group haproxy

defaults
    mode tcp
    timeout connect 5000
    timeout client 50000
    timeout server 50000
    option dontlognull
    option redispatch
    retries 3

frontend kubernetes
    bind *:6443
    default_backend k8s_masters

backend k8s_masters
    balance roundrobin
    option tcp-check
{% for master in groups['masters'] %}
    server {{ master }} {{ hostvars[master].ansible_host | default(master) }}:6443 check port 6443 inter 10s fall 3 rise 2
{% endfor %}

listen stats
    bind *:8080
    mode http
    stats enable
    stats uri /
    stats refresh 10s